diff -Nru rstudio-1.1.447.orig/src/cpp/core/system/PosixSystem.cpp rstudio-1.1.447/src/cpp/core/system/PosixSystem.cpp
--- rstudio-1.1.447.orig/src/cpp/core/system/PosixSystem.cpp	2018-04-17 20:08:08.000000000 +0000
+++ rstudio-1.1.447/src/cpp/core/system/PosixSystem.cpp	2018-04-24 20:55:40.624873664 +0000
@@ -1765,6 +1765,7 @@
 
       // setup environment
       core::system::Options env;
+      core::system::environment(&env);
       copyEnvironmentVar("PATH", &env);
       copyEnvironmentVar("MANPATH", &env);
       copyEnvironmentVar("LANG", &env);
diff -Nru rstudio-1.1.447.orig/src/cpp/server/ServerSecureKeyFile.cpp rstudio-1.1.447/src/cpp/server/ServerSecureKeyFile.cpp
--- rstudio-1.1.447.orig/src/cpp/server/ServerSecureKeyFile.cpp	2018-04-17 20:08:08.000000000 +0000
+++ rstudio-1.1.447/src/cpp/server/ServerSecureKeyFile.cpp	2018-04-25 19:57:24.642412665 +0000
@@ -18,6 +18,7 @@
 
 #include <core/system/PosixSystem.hpp>
 #include <core/system/FileMode.hpp>
+#include <core/system/Environment.hpp>
 
 #include <server/ServerSecureKeyFile.hpp>
 
@@ -36,8 +37,12 @@
          secureKeyPath = core::FilePath("/var/lib/rstudio-server") 
                                        .complete(file);
    }
-   else
-      secureKeyPath = core::FilePath("/tmp/rstudio-server").complete(file);
+   else {
+      std::string tmpPath = core::system::getenv("TMPDIR");
+      if(tmpPath.empty()) 
+         tmpPath = "/tmp";
+      secureKeyPath = core::FilePath(tmpPath + "/rstudio-server").complete(file);
+   }
 
    // read file if it already exists
    if (secureKeyPath.exists())
diff -Nru rstudio-1.1.447.orig/src/cpp/session/include/session/SessionLocalStreams.hpp rstudio-1.1.447/src/cpp/session/include/session/SessionLocalStreams.hpp
--- rstudio-1.1.447.orig/src/cpp/session/include/session/SessionLocalStreams.hpp	2018-04-17 20:08:08.000000000 +0000
+++ rstudio-1.1.447/src/cpp/session/include/session/SessionLocalStreams.hpp	2018-04-25 19:57:50.184166376 +0000
@@ -21,10 +21,11 @@
 #include <core/Error.hpp>
 #include <core/FilePath.hpp>
 #include <core/system/System.hpp>
+#include <core/system/Environment.hpp>
 
 #include <core/http/LocalStreamSocketUtils.hpp>
 
-#define kSessionLocalStreamsDir "/tmp/rstudio-rsession"
+#define kSessionLocalStreamsDir "/rstudio-rsession"
 
 namespace rstudio {
 namespace session {
@@ -32,13 +33,19 @@
 
 inline core::Error ensureStreamsDir()
 {
-   core::FilePath sessionStreamsPath(kSessionLocalStreamsDir);
+   std::string tmpPath = core::system::getenv("TMPDIR");
+   if(tmpPath.empty())
+      tmpPath = "/tmp";
+   core::FilePath sessionStreamsPath(tmpPath + kSessionLocalStreamsDir);
    return core::http::initializeStreamDir(sessionStreamsPath);
 }
-   
+
 inline core::FilePath streamPath(const std::string& file)
 {
-   core::FilePath path = core::FilePath(kSessionLocalStreamsDir).complete(file);
+   std::string tmpPath = core::system::getenv("TMPDIR");
+   if(tmpPath.empty())
+      tmpPath = "/tmp";
+   core::FilePath path = core::FilePath(tmpPath + kSessionLocalStreamsDir).complete(file);
    core::Error error = core::http::initializeStreamDir(path.parent());
    if (error)
       LOG_ERROR(error);
